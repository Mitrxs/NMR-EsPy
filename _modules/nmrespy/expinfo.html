
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>nmrespy.expinfo &#8212; NMR-EsPy  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/nameko.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Lora:400' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  </head><body>
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">NMR-EsPy  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">nmrespy.expinfo</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for nmrespy.expinfo</h1><div class="highlight"><pre>
<span></span><span class="c1"># expinfo.py</span>
<span class="c1"># Simon Hulse</span>
<span class="c1"># simon.hulse@chem.ox.ac.uk</span>
<span class="c1"># Last Edited: Sun 15 May 2022 12:12:18 BST</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.random</span> <span class="k">as</span> <span class="nn">nrandom</span>
<span class="kn">import</span> <span class="nn">scipy.integrate</span> <span class="k">as</span> <span class="nn">integrate</span>

<span class="kn">from</span> <span class="nn">nmrespy._freqconverter</span> <span class="kn">import</span> <span class="n">FrequencyConverter</span>
<span class="kn">from</span> <span class="nn">nmrespy._sanity</span> <span class="kn">import</span> <span class="n">sanity_check</span><span class="p">,</span> <span class="n">funcs</span> <span class="k">as</span> <span class="n">sfuncs</span>
<span class="kn">from</span> <span class="nn">nmrespy</span> <span class="kn">import</span> <span class="n">sig</span>


<div class="viewcode-block" id="ExpInfo"><a class="viewcode-back" href="../../content/references/expinfo.html#nmrespy.ExpInfo">[docs]</a><span class="k">class</span> <span class="nc">ExpInfo</span><span class="p">(</span><span class="n">FrequencyConverter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Stores information about NMR experiments.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">sw</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">offset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sfo</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nuclei</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">default_pts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fn_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dim</span>
<span class="sd">            The number of dimensions associated with the experiment.</span>

<span class="sd">        sw</span>
<span class="sd">            The sweep width (spectral window) (Hz).</span>

<span class="sd">        offset</span>
<span class="sd">            The transmitter offset (Hz).</span>

<span class="sd">        sfo</span>
<span class="sd">            The transmitter frequency (MHz).</span>

<span class="sd">        nuclei</span>
<span class="sd">            The identity of each channel.</span>

<span class="sd">        default_pts</span>
<span class="sd">            The default points included in methods that require points, if not</span>
<span class="sd">            explicitely stated.</span>

<span class="sd">        fn_mode</span>
<span class="sd">            Acquisition mode in indirect dimensions of mulit-dimensional experiments.</span>
<span class="sd">            If the data is not 1-dimensional, this should be one of</span>
<span class="sd">            ``QF``, ``QSED``, ``TPPI``, ``States``, ``States-TPPI``, ``Echo-Anitecho``,</span>
<span class="sd">            and if not explicitely given, it will be set as ``QF``.</span>

<span class="sd">        kwargs</span>
<span class="sd">            Any extra parameters to be included</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sanity_check</span><span class="p">((</span><span class="s2">&quot;dim&quot;</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_int</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span><span class="s2">&quot;min_value&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dim</span> <span class="o">=</span> <span class="n">dim</span>
        <span class="n">sanity_check</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;sw&quot;</span><span class="p">,</span> <span class="n">sw</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_float_list</span><span class="p">,</span> <span class="p">(),</span>
                <span class="p">{</span>
                    <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span>
                    <span class="s2">&quot;len_one_can_be_listless&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;must_be_positive&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">),</span>
            <span class="p">(</span>
                <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_float_list</span><span class="p">,</span> <span class="p">(),</span>
                <span class="p">{</span>
                    <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span>
                    <span class="s2">&quot;len_one_can_be_listless&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="p">(</span>
                <span class="s2">&quot;sfo&quot;</span><span class="p">,</span> <span class="n">sfo</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_float_list</span><span class="p">,</span> <span class="p">(),</span>
                <span class="p">{</span>
                    <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span>
                    <span class="s2">&quot;len_one_can_be_listless&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;must_be_positive&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;allow_none&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="p">(</span>
                <span class="s2">&quot;nuclei&quot;</span><span class="p">,</span> <span class="n">nuclei</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_nucleus_list</span><span class="p">,</span> <span class="p">(),</span>
                <span class="p">{</span>
                    <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span>
                    <span class="s2">&quot;len_one_can_be_listless&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;none_allowed&quot;</span><span class="p">:</span> <span class="kc">True</span>
                <span class="p">},</span>
                <span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="p">(</span>
                <span class="s2">&quot;default_pts&quot;</span><span class="p">,</span> <span class="n">default_pts</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_int_list</span><span class="p">,</span> <span class="p">(),</span>
                <span class="p">{</span>
                    <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span>
                    <span class="s2">&quot;len_one_can_be_listless&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;must_be_positive&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">dim</span> <span class="o">*</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_totuple</span><span class="p">(</span><span class="n">sw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_totuple</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_totuple</span><span class="p">(</span><span class="n">sfo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nuclei</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_totuple</span><span class="p">(</span><span class="n">nuclei</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_totuple</span><span class="p">(</span><span class="n">default_pts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fn_mode</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">sanity_check</span><span class="p">((</span><span class="s2">&quot;fn_mode&quot;</span><span class="p">,</span> <span class="n">fn_mode</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_fn_mode</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{},</span> <span class="kc">True</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">fn_mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fn_mode</span> <span class="o">=</span> <span class="s2">&quot;QF&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fn_mode</span> <span class="o">=</span> <span class="n">fn_mode</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sfo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sw</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_pts</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_totuple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">isiter</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="p">(</span><span class="n">obj</span><span class="p">,)</span>
        <span class="k">elif</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>

<div class="viewcode-block" id="ExpInfo.sw"><a class="viewcode-back" href="../../content/references/expinfo.html#nmrespy.ExpInfo.sw">[docs]</a>    <span class="k">def</span> <span class="nf">sw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hz&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get the sweep width.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        unit</span>
<span class="sd">            Must be ``&quot;hz&quot;`` or ``&quot;ppm&quot;``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sanity_check</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_frequency_unit</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,)),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sw</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;hz-&gt;</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExpInfo.offset"><a class="viewcode-back" href="../../content/references/expinfo.html#nmrespy.ExpInfo.offset">[docs]</a>    <span class="k">def</span> <span class="nf">offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hz&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get the transmitter offset frequency.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        unit</span>
<span class="sd">            Must be ``&quot;hz&quot;`` or ``&quot;ppm&quot;``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sanity_check</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_frequency_unit</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,)),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_offset</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;hz-&gt;</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sfo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]]:</span>
        <span class="s2">&quot;Get the transmitter frequency (MHz).&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sfo</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;Get the nuclei associated with each channel.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nuclei</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">unicode_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;Get the nuclei associated with each channel with superscript numbers.</span>

<span class="sd">        .. code:: python3</span>

<span class="sd">           &gt;&gt;&gt; expinfo = ExpInfo(..., nuclei=(&quot;1H&quot;, &quot;15N&quot;), ...)</span>
<span class="sd">           &gt;&gt;&gt; expinfo.unicode_nuclei</span>
<span class="sd">           (&#39;¹H&#39;, &#39;¹⁵N&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nuclei</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span>
            <span class="sa">u</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;0123456789&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;⁰¹²³⁴⁵⁶⁷⁸⁹&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nuclei</span>
        <span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">latex_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;Get the nuclei associated with each channel with for use in LaTeX.</span>

<span class="sd">        .. code:: python3</span>

<span class="sd">           &gt;&gt;&gt; expinfo = ExpInfo(..., nuclei=(&quot;1H&quot;, &quot;15N&quot;), ...)</span>
<span class="sd">           &gt;&gt;&gt; expinfo.latex_nuclei</span>
<span class="sd">           (&#39;\\textsuperscript{1}H&#39;, &#39;\\textsuperscript{15}N&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nuclei</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">components</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\d+)([A-Za-z]+)&quot;</span><span class="p">,</span> <span class="n">nucleus</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">nucleus</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">nucleus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nuclei</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">textsuperscript</span><span class="se">{{</span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">}}{{</span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">}}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">components</span>
        <span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_pts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get default points associated with each dimension.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_pts</span>

    <span class="nd">@default_pts</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">default_pts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sanity_check</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;default_pts&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_int_list</span><span class="p">,</span> <span class="p">(),</span>
                <span class="p">{</span>
                    <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span>
                    <span class="s2">&quot;len_one_can_be_listless&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;must_be_positive&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_totuple</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sw</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_pts</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fn_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get acquisiton mode in indirect dimensions.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fn_mode</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get number of dimensions in the experiment.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim</span>

<div class="viewcode-block" id="ExpInfo.unpack"><a class="viewcode-back" href="../../content/references/expinfo.html#nmrespy.ExpInfo.unpack">[docs]</a>    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Unpack attributes.</span>

<span class="sd">        `args` should be strings with names that match attribute names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">to_underscore</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;sw&quot;</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="s2">&quot;sfo&quot;</span><span class="p">,</span> <span class="s2">&quot;nuclei&quot;</span><span class="p">,</span> <span class="s2">&quot;dim&quot;</span><span class="p">,</span> <span class="s2">&quot;deafult_pts&quot;</span><span class="p">,</span> <span class="s2">&quot;fn_mode&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">ud_args</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">to_underscore</span> <span class="k">else</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ud_args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">ud_args</span><span class="p">])</span></div>

<div class="viewcode-block" id="ExpInfo.get_timepoints"><a class="viewcode-back" href="../../content/references/expinfo.html#nmrespy.ExpInfo.get_timepoints">[docs]</a>    <span class="k">def</span> <span class="nf">get_timepoints</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">start_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">meshgrid</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Construct time-points which reflect the experiment parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pts</span>
<span class="sd">            The number of points to construct the time-points with in each dimesnion.</span>
<span class="sd">            If ``None``, and ``self.default_pts`` is a tuple of ints, it will be</span>
<span class="sd">            used.</span>

<span class="sd">        start_time</span>
<span class="sd">            The start time in each dimension. If set to `None`, the initial</span>
<span class="sd">            point in each dimension with be ``0.0``. To set non-zero start times,</span>
<span class="sd">            a list of floats or strings can be used. If floats are used, they</span>
<span class="sd">            specify the first value in each dimension in seconds. Alternatively,</span>
<span class="sd">            strings of the form ``f&#39;{N}dt&#39;``, where ``N`` is an integer, may be</span>
<span class="sd">            used, which indicates a cetain multiple of the difference in time</span>
<span class="sd">            between two adjacent points.</span>

<span class="sd">        meshgrid</span>
<span class="sd">            If time-points are being derived for a N-dimensional signal (N &gt; 1),</span>
<span class="sd">            setting this argument to ``True`` will return N-dimensional arrays</span>
<span class="sd">            corresponding to all combinations of points in each dimension.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sanity_check</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;pts&quot;</span><span class="p">,</span> <span class="n">pts</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_int_list</span><span class="p">,</span> <span class="p">(),</span>
                <span class="p">{</span>
                    <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span>
                    <span class="s2">&quot;len_one_can_be_listless&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;must_be_positive&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="p">(</span>
                <span class="s2">&quot;start_time&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_start_time</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,),</span>
                <span class="p">{</span><span class="s2">&quot;len_one_can_be_listless&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">pts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_pts</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_totuple</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">sanity_check</span><span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;meshgrid&quot;</span><span class="p">,</span> <span class="n">meshgrid</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_bool</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">start_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="p">[</span><span class="n">start_time</span><span class="p">]</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(-?\d+)dt$&quot;</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">sw</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">st</span>
            <span class="k">for</span> <span class="n">st</span><span class="p">,</span> <span class="n">sw</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sw</span><span class="p">())</span>
        <span class="p">]</span>

        <span class="n">tp</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">pt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">sw</span><span class="p">,</span> <span class="n">pt</span><span class="p">)</span> <span class="o">+</span> <span class="n">st</span>
                <span class="k">for</span> <span class="n">pt</span><span class="p">,</span> <span class="n">sw</span><span class="p">,</span> <span class="n">st</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sw</span><span class="p">(),</span> <span class="n">start_time</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">meshgrid</span><span class="p">:</span>
            <span class="n">tp</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="n">tp</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">tp</span></div>

<div class="viewcode-block" id="ExpInfo.get_shifts"><a class="viewcode-back" href="../../content/references/expinfo.html#nmrespy.ExpInfo.get_shifts">[docs]</a>    <span class="k">def</span> <span class="nf">get_shifts</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hz&quot;</span><span class="p">,</span>
        <span class="n">flip</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">meshgrid</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Construct chemical shifts which reflect the experiment parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pts</span>
<span class="sd">            The number of points to construct the time-points with in each dimesnion.</span>
<span class="sd">            If ``None``, and ``self.default_pts`` is a tuple of ints, it will be</span>
<span class="sd">            used.</span>

<span class="sd">        unit</span>
<span class="sd">            Must be ``&quot;hz&quot;``, ``&quot;ppm&quot;``.</span>

<span class="sd">        flip</span>
<span class="sd">            If ``True``, the shifts will be returned in descending order, as is</span>
<span class="sd">            conventional in NMR. If `False`, the shifts will be in ascending order.</span>

<span class="sd">        meshgrid</span>
<span class="sd">            If time-points are being derived for a N-dimensional signal (N &gt; 1),</span>
<span class="sd">            setting this argument to ``True`` will return N-dimensional arrays</span>
<span class="sd">            corresponding to all combinations of points in each dimension.</span>
<span class="sd">            plot/contour plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sanity_check</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;pts&quot;</span><span class="p">,</span> <span class="n">pts</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_int_list</span><span class="p">,</span> <span class="p">(),</span>
                <span class="p">{</span>
                    <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span>
                    <span class="s2">&quot;len_one_can_be_listless&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;must_be_positive&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="p">(</span>
                <span class="s2">&quot;unit&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_frequency_unit</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,),</span>
                <span class="p">{},</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;flip&quot;</span><span class="p">,</span> <span class="n">flip</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_bool</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">pts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_pts</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_totuple</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">sanity_check</span><span class="p">((</span><span class="s2">&quot;meshgrid&quot;</span><span class="p">,</span> <span class="n">meshgrid</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_bool</span><span class="p">))</span>

        <span class="n">shifts</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span>
            <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">((</span><span class="o">-</span><span class="n">sw</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="p">(</span><span class="n">sw</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">pt</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">pt</span><span class="p">,</span> <span class="n">sw</span><span class="p">,</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sw</span><span class="p">(</span><span class="n">unit</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="n">unit</span><span class="p">))</span>
        <span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">meshgrid</span><span class="p">:</span>
            <span class="n">shifts</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="n">shifts</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shifts</span><span class="p">])</span> <span class="k">if</span> <span class="n">flip</span> <span class="k">else</span> <span class="n">shifts</span></div>

<div class="viewcode-block" id="ExpInfo.make_fid"><a class="viewcode-back" href="../../content/references/expinfo.html#nmrespy.ExpInfo.make_fid">[docs]</a>    <span class="k">def</span> <span class="nf">make_fid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">pts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">snr</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">decibels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">indirect_modulation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Construct a FID, as a summation of damped complex sinusoids.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params</span>
<span class="sd">            Parameter array with the following structure:</span>

<span class="sd">            * **1-dimensional data:**</span>

<span class="sd">              .. code:: python</span>

<span class="sd">                 params = numpy.array([</span>
<span class="sd">                    [a_1, φ_1, f_1, η_1],</span>
<span class="sd">                    [a_2, φ_2, f_2, η_2],</span>
<span class="sd">                    ...,</span>
<span class="sd">                    [a_m, φ_m, f_m, η_m],</span>
<span class="sd">                 ])</span>

<span class="sd">            * **2-dimensional data:**</span>

<span class="sd">              .. code:: python</span>

<span class="sd">                 params = numpy.array([</span>
<span class="sd">                    [a_1, φ_1, f1_1, f2_1, η1_1, η2_1],</span>
<span class="sd">                    [a_2, φ_2, f1_2, f2_2, η1_2, η2_2],</span>
<span class="sd">                    ...,</span>
<span class="sd">                    [a_m, φ_m, f1_m, f2_m, η1_m, η2_m],</span>
<span class="sd">                 ])</span>

<span class="sd">        pts</span>
<span class="sd">            The number of points to construct the time-points with in each dimesnion.</span>
<span class="sd">            If ``None``, and ``self.default_pts`` is a tuple of ints, it will be</span>
<span class="sd">            used.</span>

<span class="sd">        snr</span>
<span class="sd">            The signal-to-noise ratio. If `None` then no noise will be added</span>
<span class="sd">            to the FID.</span>

<span class="sd">        decibels</span>
<span class="sd">            If `True`, the snr is taken to be in units of decibels. If `False`,</span>
<span class="sd">            it is taken to be simply the ratio of the singal power over the</span>
<span class="sd">            noise power.</span>

<span class="sd">        indirect_modulation</span>
<span class="sd">            Acquisition mode in indirect dimension of a 2D experiment. If the</span>
<span class="sd">            data is not 1-dimensional, this should be one of:</span>

<span class="sd">            * ``None`` - :math:`y \left(t_1, t_2\right) = \sum_{m} a_m</span>
<span class="sd">              e^{\mathrm{i} \phi_m}</span>
<span class="sd">              e^{\left(2 \pi \mathrm{i} f_{1, m} - \eta_{1, m}\right) t_1}</span>
<span class="sd">              e^{\left(2 \pi \mathrm{i} f_{2, m} - \eta_{2, m}\right) t_2}`</span>
<span class="sd">            * ``&quot;amp&quot;`` - amplitude modulated pair:</span>
<span class="sd">              :math:`y_{\mathrm{cos}} \left(t_1, t_2\right) = \sum_{m} a_m</span>
<span class="sd">              e^{\mathrm{i} \phi_m}</span>
<span class="sd">              \cos\left(\left(2 \pi \mathrm{i} f_{1, m} - \eta_{1, m}\right) t_1\right)</span>
<span class="sd">              e^{\left(2 \pi \mathrm{i} f_{2, m} - \eta_{2, m}\right) t_2}`</span>
<span class="sd">              :math:`y_{\mathrm{sin}} \left(t_1, t_2\right) = \sum_{m} a_m</span>
<span class="sd">              e^{\mathrm{i} \phi_m}</span>
<span class="sd">              \sin\left(\left(2 \pi \mathrm{i} f_{1, m} - \eta_{1, m}\right) t_1\right)</span>
<span class="sd">              e^{\left(2 \pi \mathrm{i} f_{2, m} - \eta_{2, m}\right) t_2}`</span>
<span class="sd">            * ``&quot;phase&quot;`` - phase-modulated pair:</span>
<span class="sd">              :math:`y_{\mathrm{P}} \left(t_1, t_2\right) = \sum_{m} a_m</span>
<span class="sd">              e^{\mathrm{i} \phi_m}</span>
<span class="sd">              e^{\left(2 \pi \mathrm{i} f_{1, m} - \eta_{1, m}\right) t_1}</span>
<span class="sd">              e^{\left(2 \pi \mathrm{i} f_{2, m} - \eta_{2, m}\right) t_2}`</span>
<span class="sd">              :math:`y_{\mathrm{N}} \left(t_1, t_2\right) = \sum_{m} a_m</span>
<span class="sd">              e^{\mathrm{i} \phi_m}</span>
<span class="sd">              e^{\left(-2 \pi \mathrm{i} f_{1, m} - \eta_{1, m}\right) t_1}</span>
<span class="sd">              e^{\left(2 \pi \mathrm{i} f_{2, m} - \eta_{2, m}\right) t_2}`</span>

<span class="sd">            ``None`` will lead to an array of shape ``(*pts)``. ``amp`` and ``phase``</span>
<span class="sd">            will lead to an array of shape ``(2, *pts)``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sanity_check</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_parameter_array</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,)),</span>
            <span class="p">(</span>
                <span class="s2">&quot;pts&quot;</span><span class="p">,</span> <span class="n">pts</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_int_list</span><span class="p">,</span> <span class="p">(),</span>
                <span class="p">{</span>
                    <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span>
                    <span class="s2">&quot;len_one_can_be_listless&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;must_be_positive&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;snr&quot;</span><span class="p">,</span> <span class="n">snr</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_float</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span><span class="s2">&quot;greater_than_zero&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="kc">True</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;decibels&quot;</span><span class="p">,</span> <span class="n">decibels</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_bool</span><span class="p">),</span>
            <span class="p">(</span>
                <span class="s2">&quot;indirect_modulation&quot;</span><span class="p">,</span> <span class="n">indirect_modulation</span><span class="p">,</span>
                <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_one_of</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;amp&quot;</span><span class="p">,</span> <span class="s2">&quot;phase&quot;</span><span class="p">),</span> <span class="p">{},</span> <span class="kc">True</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">pts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_pts</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_totuple</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>

        <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">()</span>
        <span class="n">amp</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Center frequencies at 0 based on offset</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span><span class="p">[:,</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">offset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)]</span>
        <span class="n">damp</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)]</span>

        <span class="c1"># Time points in each dimension</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timepoints</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">meshgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
                <span class="s2">&quot;ij,j-&gt;i&quot;</span><span class="p">,</span>
                <span class="c1"># Vandermonde matrix of signal poles</span>
                <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span>
                        <span class="n">tp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="mi">2</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">damp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="p">),</span>
                <span class="c1"># Vector of complex amplitudes</span>
                <span class="n">amp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phase</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># Signal pole matrix (dimension 1)</span>
            <span class="n">z1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span>
                    <span class="n">tp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="mi">2</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">damp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># Complex amplitude vector</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phase</span><span class="p">)</span>
            <span class="c1"># Transposed signal pole matrix (dimension 2)</span>
            <span class="n">z2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span>
                    <span class="mi">2</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">freq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">damp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">tp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">indirect_modulation</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;amp&quot;</span><span class="p">,</span> <span class="s2">&quot;phase&quot;</span><span class="p">]:</span>
                <span class="n">fid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="n">pts</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex128&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">indirect_modulation</span> <span class="o">==</span> <span class="s2">&quot;amp&quot;</span><span class="p">:</span>
                    <span class="n">fid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ik,k,kj-&gt;ij&quot;</span><span class="p">,</span> <span class="n">z1</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">z2</span><span class="p">)</span>
                    <span class="n">fid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ik,k,kj-&gt;ij&quot;</span><span class="p">,</span> <span class="n">z1</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">z2</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">indirect_modulation</span> <span class="o">==</span> <span class="s2">&quot;phase&quot;</span><span class="p">:</span>
                    <span class="n">fid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ik,k,kj-&gt;ij&quot;</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">z2</span><span class="p">)</span>
                    <span class="n">fid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
                        <span class="s2">&quot;ik,k,kj-&gt;ij&quot;</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span>
                                <span class="n">tp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="o">-</span><span class="mi">2</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">damp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="p">)</span>
                        <span class="p">),</span>
                        <span class="n">alpha</span><span class="p">,</span>
                        <span class="n">z2</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">fid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ik,k,kj-&gt;ij&quot;</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">z2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">snr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fid</span> <span class="o">+=</span> <span class="n">sig</span><span class="o">.</span><span class="n">_make_noise</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span> <span class="n">snr</span><span class="p">,</span> <span class="n">decibels</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fid</span></div>

<div class="viewcode-block" id="ExpInfo.generate_random_signal"><a class="viewcode-back" href="../../content/references/expinfo.html#nmrespy.ExpInfo.generate_random_signal">[docs]</a>    <span class="k">def</span> <span class="nf">generate_random_signal</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">oscillators</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">pts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">snr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">decibels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Generate a random synthetic FID.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        oscillators</span>
<span class="sd">            Number of oscillators.</span>

<span class="sd">        pts</span>
<span class="sd">            The number of points to construct the time-points with in each dimesnion.</span>
<span class="sd">            If ``None``, and ``self.default_pts`` is a tuple of ints, it will be</span>
<span class="sd">            used.</span>

<span class="sd">        snr</span>
<span class="sd">            The signal-to-noise ratio. If `None` then no noise will be added</span>
<span class="sd">            to the FID.</span>

<span class="sd">        decibels</span>
<span class="sd">            If ``True``, the snr is taken to be in units of decibels. If ``False``,</span>
<span class="sd">            it is taken to be simply the ratio of the singal power over the</span>
<span class="sd">            noise power.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fid</span>
<span class="sd">            The synthetic FID.</span>

<span class="sd">        params</span>
<span class="sd">            Parameters used to construct the signal</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sanity_check</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;oscillators&quot;</span><span class="p">,</span> <span class="n">oscillators</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_int</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span><span class="s2">&quot;min_value&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}),</span>
            <span class="p">(</span>
                <span class="s2">&quot;pts&quot;</span><span class="p">,</span> <span class="n">pts</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_int_list</span><span class="p">,</span> <span class="p">(),</span>
                <span class="p">{</span>
                    <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span>
                    <span class="s2">&quot;must_be_positive&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">default_pts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;snr&quot;</span><span class="p">,</span> <span class="n">snr</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_float</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{},</span> <span class="kc">True</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;decibels&quot;</span><span class="p">,</span> <span class="n">decibels</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_bool</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">pts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_pts</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_totuple</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>

        <span class="c1"># low: 0.0, high: 1.0</span>
        <span class="c1"># amplitdues</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">nrandom</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">oscillators</span><span class="p">)</span>
        <span class="c1"># phases</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nrandom</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">oscillators</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="c1"># frequencies</span>
        <span class="n">f</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">nrandom</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=-</span><span class="n">s</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">o</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">s</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">o</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">oscillators</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sw</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">())</span>
        <span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="n">f</span><span class="p">))</span>
        <span class="c1"># damping</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">nrandom</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">oscillators</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="n">eta</span><span class="p">))</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">oscillators</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">make_fid</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">pts</span><span class="p">,</span> <span class="n">snr</span><span class="o">=</span><span class="n">snr</span><span class="p">,</span> <span class="n">decibels</span><span class="o">=</span><span class="n">decibels</span><span class="p">),</span> <span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExpInfo.oscillator_integrals"><a class="viewcode-back" href="../../content/references/expinfo.html#nmrespy.ExpInfo.oscillator_integrals">[docs]</a>    <span class="k">def</span> <span class="nf">oscillator_integrals</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">pts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">absolute</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">scale_relative_to</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Determine the integral of the FT of oscillators.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params</span>
<span class="sd">            Parameter array with the following structure:</span>

<span class="sd">            * **1-dimensional data:**</span>

<span class="sd">              .. code:: python</span>

<span class="sd">                 params = numpy.array([</span>
<span class="sd">                    [a_1, φ_1, f_1, η_1],</span>
<span class="sd">                    [a_2, φ_2, f_2, η_2],</span>
<span class="sd">                    ...,</span>
<span class="sd">                    [a_m, φ_m, f_m, η_m],</span>
<span class="sd">                 ])</span>

<span class="sd">            * **2-dimensional data:**</span>

<span class="sd">              .. code:: python</span>

<span class="sd">                 params = numpy.array([</span>
<span class="sd">                    [a_1, φ_1, f1_1, f2_1, η1_1, η2_1],</span>
<span class="sd">                    [a_2, φ_2, f1_2, f2_2, η1_2, η2_2],</span>
<span class="sd">                    ...,</span>
<span class="sd">                    [a_m, φ_m, f1_m, f2_m, η1_m, η2_m],</span>
<span class="sd">                 ])</span>

<span class="sd">        pts</span>
<span class="sd">            The number of points to construct the signals to be integrated in each</span>
<span class="sd">            dimesnion. If ``None``, and ``self.default_pts`` is a tuple of ints, it</span>
<span class="sd">            will be used.</span>

<span class="sd">        absolute</span>
<span class="sd">            Whether or not to take the absolute value of the spectrum before</span>
<span class="sd">            integrating.</span>

<span class="sd">        scale_relative_to</span>
<span class="sd">            If an int, the integral corresponding to ``params[scale_relative_to]``</span>
<span class="sd">            is set to ``1``, and other integrals are scaled accordingly.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The integration is performed using the composite Simpsons rule, provided</span>
<span class="sd">        by `scipy.integrate.simps &lt;https://docs.scipy.org/doc/scipy-1.5.4/\</span>
<span class="sd">        reference/generated/scipy.integrate.simps.html&gt;`_</span>

<span class="sd">        Spacing of points along the frequency axes is set as ``1`` (i.e. ``dx = 1``).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sanity_check</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_parameter_array</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,)),</span>
            <span class="p">(</span>
                <span class="s2">&quot;pts&quot;</span><span class="p">,</span> <span class="n">pts</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_int_list</span><span class="p">,</span> <span class="p">(),</span>
                <span class="p">{</span>
                    <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span>
                    <span class="s2">&quot;len_one_can_be_listless&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;must_be_positive&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">default_pts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;absolute&quot;</span><span class="p">,</span> <span class="n">absolute</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_bool</span><span class="p">),</span>
            <span class="p">(</span>
                <span class="s2">&quot;scale_relative_to&quot;</span><span class="p">,</span> <span class="n">scale_relative_to</span><span class="p">,</span> <span class="n">sfuncs</span><span class="o">.</span><span class="n">check_int</span><span class="p">,</span> <span class="p">(),</span>
                <span class="p">{</span>
                    <span class="s2">&quot;min_value&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;max_value&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Integrals are the spectra initally. They are mutated and converted</span>
        <span class="c1"># into the integrals during the for loop.</span>
        <span class="n">integrals</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">sig</span><span class="o">.</span><span class="n">ft</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">make_fid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">pts</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span>
        <span class="p">]</span>
        <span class="n">integrals</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">absolute</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">integrals</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">integrals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span><span class="p">)):</span>
            <span class="n">integrals</span> <span class="o">=</span> <span class="p">[</span><span class="n">integrate</span><span class="o">.</span><span class="n">simps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">integrals</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scale_relative_to</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">integrals</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">/</span> <span class="n">integrals</span><span class="p">[</span><span class="n">scale_relative_to</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">integrals</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">integrals</span></div></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><style>
.aligncenter {
    text-align: center;
}
</style>

<a href="https://foroozandehgroup.github.io/NMR-EsPy/">
    <img style="padding: 0px 0px 12px"
         src="https://raw.githubusercontent.com/foroozandehgroup/NMR-EsPy/master/nmrespy/images/nmrespy_full.png"
         alt="NMR-EsPy logo"
         width=230px
         height=auto />
</a>

<p class="aligncenter">
    <a href="https://github.com/foroozandehgroup/NMR-EsPy">
        <img src="https://raw.githubusercontent.com/foroozandehgroup/NMR-EsPy/master/nmrespy/images/github.png"
             alt="Github"
             style="padding: 0px 30px 0px 0px"
             width=auto
             height=30px />
    </a>

    <a href="mailto:simon.hulse@chem.ox.ac.uk?subject=NMR-EsPy%20query">
        <img src="https://raw.githubusercontent.com/foroozandehgroup/NMR-EsPy/master/nmrespy/images/email_icon.png"
             alt="email"
             style="padding: 0px 30px 0px 0px"
             width=auto
             height=30px />
    </a>

    <a href="https://foroozandeh.chem.ox.ac.uk/home">
        <img src="https://raw.githubusercontent.com/foroozandehgroup/NMR-EsPy/develop/nmrespy/images/link.png"
             alt="Group website"
             width=auto
             height=30px />
    </a>
</p><h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation index</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
  </body>
</html>