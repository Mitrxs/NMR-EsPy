
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Estimation Set-up &#8212; NMR-EsPy  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/nameko.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Estimation Result" href="result.html" />
    <link rel="prev" title="Loading the GUI" href="loading.html" />
   
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Lora:400' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  </head><body>
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="result.html" title="Estimation Result"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="loading.html" title="Loading the GUI"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">NMR-EsPy  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >The NMR-EsPy GUI</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Using The GUI</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Estimation Set-up</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <style>
   .grey {color:#808080}
   .red {color:#ff0000}
   .green {color:#008000}
   .blue {color:#0000ff}
   .oscblue {color:#1063e0}
   .oscorange {color:#eb9310}
   .oscgreen {color:#2bb539}
   .oscred {color:#d4200c}
   .regiongreen {color: #7fd47f}
   .regionblue {color: #66b3ff}
</style><section id="estimation-set-up">
<h1>Estimation Set-up<a class="headerlink" href="#estimation-set-up" title="Permalink to this headline">¶</a></h1>
<p>The following is a screenshot of the NMR-EsPy GUI calculation set-up window.
Key features of the window are annotated:</p>
<img alt="../../../_images/setup_window.png" class="align-center" src="../../../_images/setup_window.png" style="width: 636.0px; height: 706.8px;" />
<section id="plot-navigation">
<h2>Plot Navigation<a class="headerlink" href="#plot-navigation" title="Permalink to this headline">¶</a></h2>
<p>The Plot navigation toolbar enables you to change the view of the data.
It is an edited version of
<a class="reference external" href="https://matplotlib.org/3.2.2/users/navigation_toolbar.html">matplotlib’s toolbar</a>,
with the following available buttons:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 9%" />
<col style="width: 91%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Icon</p></th>
<th class="head"><p>Role</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><img alt="../../../_images/home.png" class="align-center" src="../../../_images/home.png" style="width: 60%;" />
</td>
<td><p>Return to the original plot view.</p></td>
</tr>
<tr class="row-odd"><td><img alt="../../../_images/back.png" class="align-center" src="../../../_images/back.png" style="width: 60%;" />
</td>
<td><p>Return to the previous plot view.</p></td>
</tr>
<tr class="row-even"><td><img alt="../../../_images/forward.png" class="align-center" src="../../../_images/forward.png" style="width: 60%;" />
</td>
<td><p>Undo a return to a previous view</p></td>
</tr>
<tr class="row-odd"><td><img alt="../../../_images/pan.png" class="align-center" src="../../../_images/pan.png" style="width: 60%;" />
</td>
<td><p>Pan. Note that panning outside the spectral window is not possible.</p></td>
</tr>
<tr class="row-even"><td><img alt="../../../_images/zoom.png" class="align-center" src="../../../_images/zoom.png" style="width: 60%;" />
</td>
<td><p>Zoom.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="phase-correction">
<h2>Phase Correction<a class="headerlink" href="#phase-correction" title="Permalink to this headline">¶</a></h2>
<p>The GUI has the following appearance when the <cite>Phase Correction</cite> tab is
selected:</p>
<img alt="../../../_images/setup_window_phase_tab.png" class="align-center" src="../../../_images/setup_window_phase_tab.png" style="width: 636.0px; height: 640.8px;" />
<p>Phase correction can be carried out by editing the
pivot (red line in the above figure), zero-order phase and first-order phase.
This is unlikely to be necessary if you are considering processed data, however
you will probably need to do this if you are considering the raw time-domain
data.</p>
<p>The values may be changed either by adjusting the scale widgets, or by manually
inputting desired values into the adjacent entry boxes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Validating entry box inputs</strong></p>
<p>For the majority of entry boxes in the GUI, you will notice that the box
turns red after you manually change its contents. This indicates
that the input must adhere to certain criteria (i.e. it must be a number, a
valid path on your computer etc.), and it has not been validated. After you
have changed the value in an entry box, press <code class="docutils literal notranslate"><span class="pre">&lt;Return&gt;</span></code>. The entry box
will then turn back to its original colour. If the value you
provided is valid for the given parameter, the value will be kept. If the
value provided is invalid, the entry box will revert back to the previous
valid value.</p>
<p>The video below illustrates this. Initially, I try to change the value
of the pivot to 7ppm. As soon as the entry box is changed, it goes red,
indicating that it needs validating. When <code class="docutils literal notranslate"><span class="pre">&lt;Return&gt;</span></code> is pressed, as 7 is
a valid value for the pivot (it is a number, and is within the spectrum’s
sweep width), the pivot is changed accordingly. Note that it is changed to
the closest valid value to the nearest 4dp, which happens to be 6.9999ppm
in this case.</p>
<p>After this, I try to change the pivot to the value <code class="docutils literal notranslate"><span class="pre">invalid</span></code> which of
course makes no sense in the context of a pivot. As it is invalid, when
<code class="docutils literal notranslate"><span class="pre">&lt;Return&gt;</span></code> is pressed, the pivot entry box reverts back to the last valid
value it had.</p>
  <video width="640" height="640" style="display:block; margin: 0 auto;" controls autoplay>
    <source src="../../media/gui/entry_widget_example.mp4" type="video/mp4">
    Your browser doesn't support the video tag
  </video>

Note that if you try to run the estimation routine while at least one entry
box has not be validated, you will be prevented from doing so:

.. image:: ../../media/gui/windows/unverified_parameter_window.png
   :align: center
   :scale: 80%</div>
</section>
<section id="region-selection">
<h2>Region Selection<a class="headerlink" href="#region-selection" title="Permalink to this headline">¶</a></h2>
<p>For typical NMR signals, the estimation routine used in NMR-EsPy is
too expensive to analyse the entire signal. For this reason, it is typically
necessary to generate a signal which has been frequency-filtered, drastically
reducing the computation time, and increasing the accuracy of the estimation
for the region chosen. As a rule of thumb, try to choose a region with fewer
than 30 peaks. Any more than this, and the routine may take too long for you
to bear.</p>
<p>To filter the signal, two regions of the spectrum need to be indicated:</p>
<ul class="simple">
<li><p>The region to estimate, highlighted in <span class="regiongreen">green</span>.</p></li>
<li><p>A region which appears to contain no signals
(i.e. is just experimental noise), highlighted in <span class="regionblue">blue</span>.</p></li>
</ul>
<p>These regions can be adjusted by editing the scale widgets and entry boxes
in the <cite>Region Selection</cite> tab.</p>
</section>
<section id="advanced-estimation-settings">
<h2>Advanced Estimation Settings<a class="headerlink" href="#advanced-estimation-settings" title="Permalink to this headline">¶</a></h2>
<p>Clicking the <cite>Advanced Settings</cite> button will load a window enabling a few
more advanced aspects of the estimation routine to be tweaked:</p>
<img alt="../../../_images/advanced_settings_window.png" class="align-center" src="../../../_images/advanced_settings_window.png" style="width: 315.15px; height: 288.15px;" />
<p>Below is a summary of the meaning of all of these parameters.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For the majority of cases, you should find that the default parameters
provided will be suitable.</p>
</div>
<section id="matrix-pencil-method-options">
<h3>Matrix Pencil Method Options<a class="headerlink" href="#matrix-pencil-method-options" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>The Matrix Pencil Method (MPM) is a singular-value decomposition-based approach
for estimating signal parameters. It is used in NMR-EsPy to generate an
initial guess for numerical optimisation. It is possible to either manually
choose how many oscillators to generate using the MPM, or to
estimate the number of oscillators using the Minimum Description Length (MDL).</p>
<ul class="simple">
<li><p><cite>Use MDL</cite> - Whether or not to use the Minimum Description Length.
By default, the MDL will be used.</p></li>
<li><p><cite>Number of Oscillators</cite> - The number of oscillators used in the MPM.
This can only be specified if <cite>Use MDL</cite> is unticked.</p></li>
</ul>
</div></blockquote>
</section>
<section id="nonlinear-programming-options">
<h3>Nonlinear Programming Options<a class="headerlink" href="#nonlinear-programming-options" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>The result of the Matrix Pencil Method is fed into a nonlinear programming
(NLP) routine to determine the final signal parameter estimate.</p>
<ul class="simple">
<li><p><cite>NLP method</cite> - The optimisation routine. This can be one of
<cite>Gauss-Newton</cite> (default), <cite>Exact Newton</cite>, or <cite>L-BFGS</cite>.
The main difference between these methods is the means by which the
<a class="reference external" href="https://en.wikipedia.org/wiki/Hessian_matrix">Hessian matrix</a> (a matrix
of second order derivatives) is computed.</p></li>
<li><p><cite>Maximum iterations</cite> - The largest number of iterations to perform before
terminating an returning the optimiser. The default value is dependent on
the NLP algorithm used (200 if Gauss-Newton is selected, 100 for
Trust-Region, and 500 for L-BFGS).</p></li>
<li><p><cite>Optimise phase variance</cite> - Specifies whether to consider the variance of
oscillator phases during the estimation routine. If your data is derived
from a well-phased spectrum, it is advised you have this selected.</p></li>
</ul>
</div></blockquote>
<p>Once you are happy with the estimation setup, simply click the <em>Run</em> button.
You will find that details of the routine are output to the terminal as it
runs.</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><style>
.aligncenter {
    text-align: center;
}
</style>

<a href="https://foroozandehgroup.github.io/NMR-EsPy/">
    <img style="padding: 0px 0px 12px"
         src="https://raw.githubusercontent.com/foroozandehgroup/NMR-EsPy/master/nmrespy/images/nmrespy_full.png"
         alt="NMR-EsPy logo"
         width=230px
         height=auto />
</a>

<p class="aligncenter">
    <a href="https://github.com/foroozandehgroup/NMR-EsPy">
        <img src="https://raw.githubusercontent.com/foroozandehgroup/NMR-EsPy/master/nmrespy/images/github.png"
             alt="Github"
             style="padding: 0px 30px 0px 0px"
             width=auto
             height=30px />
    </a>

    <a href="mailto:simon.hulse@chem.ox.ac.uk?subject=NMR-EsPy%20query">
        <img src="https://raw.githubusercontent.com/foroozandehgroup/NMR-EsPy/master/nmrespy/images/email_icon.png"
             alt="email"
             style="padding: 0px 30px 0px 0px"
             width=auto
             height=30px />
    </a>

    <a href="https://foroozandeh.chem.ox.ac.uk/home">
        <img src="https://raw.githubusercontent.com/foroozandehgroup/NMR-EsPy/develop/nmrespy/images/link.png"
             alt="Group website"
             width=auto
             height=30px />
    </a>
</p>
  <div>
    <h3><a href="../../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Estimation Set-up</a><ul>
<li><a class="reference internal" href="#plot-navigation">Plot Navigation</a></li>
<li><a class="reference internal" href="#phase-correction">Phase Correction</a></li>
<li><a class="reference internal" href="#region-selection">Region Selection</a></li>
<li><a class="reference internal" href="#advanced-estimation-settings">Advanced Estimation Settings</a><ul>
<li><a class="reference internal" href="#matrix-pencil-method-options">Matrix Pencil Method Options</a></li>
<li><a class="reference internal" href="#nonlinear-programming-options">Nonlinear Programming Options</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div><h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation index</a><ul>
  <li><a href="../index.html">The NMR-EsPy GUI</a><ul>
  <li><a href="index.html">Using The GUI</a><ul>
      <li>Previous: <a href="loading.html" title="previous chapter">Loading the GUI</a></li>
      <li>Next: <a href="result.html" title="next chapter">Estimation Result</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/content/gui/usage/setup.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
  </body>
</html>